IF(DB_ID('FoodSavers') IS NULL)
	CREATE DATABASE FoodSavers
GO

USE FoodSavers;
GO


IF OBJECT_ID ('Users') IS NULL
	CREATE TABLE Users
	(
		UserId INT NOT NULL IDENTITY(1,1),
		UserName NVARCHAR(100) NOT NULL,
		UserSurname NVARCHAR(100) NOT NULL,
		UserAge INT NOT NULL,
		UserEmail NVARCHAR(100) NOT NULL,
		UserPhone NVARCHAR(100) NOT NULL,
		UserAdress NVARCHAR(100) NOT NULL,
		UserPass NVARCHAR(50) NOT NULL,
		CONSTRAINT PK_USER PRIMARY KEY (UserId),
		CONSTRAINT UK_UserEmail UNIQUE (UserEmail)
	)
GO


IF OBJECT_ID ('Food') IS NULL
	CREATE TABLE Food
	(
		FoodId INT NOT NULL IDENTITY(1,1),
		FoodName NVARCHAR(100) NOT NULL,
		FoodExpirationDate DATE NOT NULL,
		FoodType NVARCHAR(100) NOT NULL,
		FoodQuantity NVARCHAR(100) NOT NULL,
		Available NVARCHAR(50), 
		UserId INT NOT NULL,
		CONSTRAINT PK_FOOD PRIMARY KEY (FoodId)
	)
GO

IF OBJECT_ID('FK_User_Food') IS NULL
	ALTER TABLE Food ADD CONSTRAINT FK_User_Food FOREIGN KEY (UserId) REFERENCES Users(UserId) ON DELETE CASCADE
GO

IF OBJECT_ID ('Friends') IS NULL
	CREATE TABLE Friends
	(
		FriendsId INT NOT NULL IDENTITY(1,1),
		UserFriendId INT NOT NULL,
		UserID INT NOT NULL,
		CONSTRAINT PK_FRIENDS PRIMARY KEY (FriendsID)
	)
GO

IF OBJECT_ID('FK_User_Friend') IS NULL
	ALTER TABLE Friends ADD CONSTRAINT FK_User_Friend FOREIGN KEY (UserId) REFERENCES Users(UserId) ON DELETE CASCADE
GO

IF OBJECT_ID ('Groups') IS NULL
	CREATE TABLE Groups
	(
		GroupId INT NOT NULL IDENTITY(1,1),
		CreatorId INT NOT NULL,
		GroupDescription NVARCHAR(100)NOT NULL,
		CONSTRAINT PK_GROUPS PRIMARY KEY (GroupId)
	)
GO

IF OBJECT_ID('FK_User_Group') IS NULL
	ALTER TABLE Groups ADD CONSTRAINT FK_User_Group FOREIGN KEY (CreatorId) REFERENCES Users(UserId) ON DELETE CASCADE
GO

IF OBJECT_ID('GroupsUsers') IS NULL
	CREATE TABLE GroupsUsers
	(
		GroupsUsersId INT NOT NULL IDENTITY(1,1),
		UserID INT NOT NULL,
		GroupId INT NOT NULL,
		CONSTRAINT PK_GROUPSUSERS PRIMARY KEY(GroupsUsersId)
	)
GO

IF OBJECT_ID('FK_User_GroupUsers') IS NULL
	ALTER TABLE GroupsUsers ADD CONSTRAINT FK_User_GroupsUsers FOREIGN KEY (UserId) REFERENCES Users(UserId) 
GO

IF OBJECT_ID('FK_GroupsUsers_Groups') IS NULL
	ALTER TABLE GroupsUsers ADD CONSTRAINT FK_GroupsUsers_Groups FOREIGN KEY (GroupId) REFERENCES Groups(GroupId) ON DELETE CASCADE
GO

